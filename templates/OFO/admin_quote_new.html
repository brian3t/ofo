<html><head><title>..:: {ADMINISTRATION_MSG} :: {ADMIN_QUOTES_MSG} ::..</title>
<meta http-equiv="Content-Type" content="text/html; charset={CHARSET}">
<link rel="stylesheet" href="../styles/admin.css" type="text/css">
</head>
<body>
<style>
<!--
table.quote_details {border-collapse: collapse;}
table.quote_details td {
	border: 1px solid #000000;
}
-->
</style>
<script language="javascript">
<!--

function CheckForm()
{
  var user_name = document.getElementById("user_name");
  var user_email = document.getElementById("user_email");
  var request_description = document.getElementById("request_description");
 
 //alert (user_name.value); 
  if  (user_name.value=="")
  {
    alert("PLease enter {USER_NAME_MSG}");
    user_name.focus();
    return false;
  } 
  
  if  (user_email.value=="")
  {
    alert("Please enter User email");
    user_email.focus();
    return false;
  } 

	if  (user_email.value!="")
	{
	  var filter  = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
		if (!filter.test(user_email.value)) 
		{ alert ("Incorrect email!"); return false; }
	}
	
	   
	if  (request_description.value=="")
  {
    alert("Please enter description");
    request_description.focus();
    return false;
  }
  
  	document.form_admin_quote_new.submit();
	return true; 
}

function Change{DESC_MSG}r()
{
  	var changed_descr = document.getElementById("changed_descr");
  	var	description = document.getElementById("request_description");
  	
  	changed_descr.value = description.value;
  	//alert(changed_descr.value);
}

function CheckDate(DateID)
{
	var	date_for_check = document.getElementById(DateID);
		  	if (date_for_check.value!="") {
			var str=date_for_check.value;
			//alert(str);
			var reg=/[A-Za-z]{3,}\s[0-9]{4}/;
			//[1-3]{1}[0-9]{0,1}[\s,][1-2]{1}[0-9]{3}/;
			var result=reg.test(str) ? "1": "2";
			if (result == "2") 
			{
			alert("{DATE_MSG} is not correct. Please try again.");
			date_for_check.focus();
			return false;
			}
			else return true;			
		}
}

function CheckDate_2()
{
  	var date_for_check = new Array(4);
	date_for_check[0] = document.getElementById("date_1");
  	date_for_check[1] = document.getElementById("date_2");
  	date_for_check[2] = document.getElementById("date_3");
  	date_for_check[3] = document.getElementById("date_4");
  	//var alert_str = ""; 
  	for (i=0; i<4; i++)
  	{
	  	if (date_for_check[i].value!="") {
			var str=date_for_check[i].value;
			//alert(str);
			var reg=/[A-Za-z]{3,}\s[0-9]{4}/;
			//[1-3]{1}[0-9]{0,1}[\s,][1-2]{1}[0-9]{3}/;
			var result=reg.test(str) ? "1": "2";
			if (result == "2") 
			{
			alert("{DATE_MSG} is not correct. Please try again.");
			date_for_check[i].focus();
			return false;
			}		
		}
	}
}

//set total price
function setPrice()
{
  
  var price_1 = document.getElementById('price_1');	
  var price_2 = document.getElementById('price_2');	
  var price_3 = document.getElementById('price_3');	
  var price_4 = document.getElementById('price_4');	
  var total_price = document.getElementById('quoted_price');
  //var qqq = price_1.value;
  var t_p = 0;
  if (qqq = price_1.value) t_p = t_p + parseFloat(qqq);
  if (qqq2 = price_2.value) t_p = t_p + parseFloat(qqq2);
  if (qqq3 = price_3.value) t_p = t_p + parseFloat(qqq3);
  if (qqq4 = price_4.value) t_p = t_p + parseFloat(qqq4);
  //alert (t_p);
  t_p = Math.round(1000*t_p)/1000;
  total_price.value = t_p;
}
 
//copy text
function getSelText_my(TxtName)
{
  	var textbox = document.getElementById(TxtName);	
  	if (navigator.appName == 'Netscape')
  	{
		var sl = (document.form_admin_quote_new.request_description.value).substring(document.form_admin_quote_new.request_description.selectionStart,document.form_admin_quote_new.request_description.selectionEnd); 	
		textbox.value =  sl;	 	   
	}
		else {
		 	document.form_admin_quote_new.request_description.focus();
		 	sl = document.selection.createRange().text;
			textbox.value =  sl;	 	
		}
 
}

function _isInteger(val) {
	var digits="1234567890";
	for (var i=0; i < val.length; i++) {
		if (digits.indexOf(val.charAt(i))==-1) { return false; }
		}
	return true;
	}
function _getInt(str,i,minlength,maxlength) {
	for (var x=maxlength; x>=minlength; x--) {
		var token=str.substring(i,i+x);
		if (token.length < minlength) { return null; }
		if (_isInteger(token)) { return token; }
		}
	return null;
	}

function getDateFromFormat(val,format) {
  var MONTH_NAMES=new Array('January','February','March','April','May','June','July','August','September','October','November','December','Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec');
var DAY_NAMES=new Array('Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sun','Mon','Tue','Wed','Thu','Fri','Sat');
	val=val+"";
	format=format+"";
	var i_val=0;
	var i_format=0;
	var c="";
	var token="";
	var token2="";
	var x,y;
	var now=new Date();
	var year=now.getYear();
	var month=now.getMonth()+1;
	var date=1;
	var hh=now.getHours();
	var mm=now.getMinutes();
	var ss=now.getSeconds();
	var ampm="";
	
	while (i_format < format.length) {
		// Get next token from format string
		c=format.charAt(i_format);
		token="";
		while ((format.charAt(i_format)==c) && (i_format < format.length)) {
			token += format.charAt(i_format++);
			}
		// Extract contents of value based on format token
		if (token=="yyyy" || token=="yy" || token=="y") {
			if (token=="yyyy") { x=4;y=4; }
			if (token=="yy")   { x=2;y=2; }
			if (token=="y")    { x=2;y=4; }
			year=_getInt(val,i_val,x,y);
			if (year==null) { return 0; }
			i_val += year.length;
			if (year.length==2) {
				if (year > 70) { year=1900+(year-0); }
				else { year=2000+(year-0); }
				}
			}
		else if (token=="MMM"||token=="NNN"){
			month=0;
			for (var i=0; i<MONTH_NAMES.length; i++) {
				var month_name=MONTH_NAMES[i];
				if (val.substring(i_val,i_val+month_name.length).toLowerCase()==month_name.toLowerCase()) {
					if (token=="MMM"||(token=="NNN"&&i>11)) {
						month=i+1;
						if (month>12) { month -= 12; }
						i_val += month_name.length;
						break;
						}
					}
				}
			if ((month < 1)||(month>12)){return 0;}
			}
		else if (token=="EE"||token=="E"){
			for (var i=0; i<DAY_NAMES.length; i++) {
				var day_name=DAY_NAMES[i];
				if (val.substring(i_val,i_val+day_name.length).toLowerCase()==day_name.toLowerCase()) {
					i_val += day_name.length;
					break;
					}
				}
			}
		else if (token=="MM"||token=="M") {
			month=_getInt(val,i_val,token.length,2);
			if(month==null||(month<1)||(month>12)){return 0;}
			i_val+=month.length;}
		else if (token=="dd"||token=="d") {
			date=_getInt(val,i_val,token.length,2);
			if(date==null||(date<1)||(date>31)){return 0;}
			i_val+=date.length;}
		else if (token=="hh"||token=="h") {
			hh=_getInt(val,i_val,token.length,2);
			if(hh==null||(hh<1)||(hh>12)){return 0;}
			i_val+=hh.length;}
		else if (token=="HH"||token=="H") {
			hh=_getInt(val,i_val,token.length,2);
			if(hh==null||(hh<0)||(hh>23)){return 0;}
			i_val+=hh.length;}
		else if (token=="KK"||token=="K") {
			hh=_getInt(val,i_val,token.length,2);
			if(hh==null||(hh<0)||(hh>11)){return 0;}
			i_val+=hh.length;}
		else if (token=="kk"||token=="k") {
			hh=_getInt(val,i_val,token.length,2);
			if(hh==null||(hh<1)||(hh>24)){return 0;}
			i_val+=hh.length;hh--;}
		else if (token=="mm"||token=="m") {
			mm=_getInt(val,i_val,token.length,2);
			if(mm==null||(mm<0)||(mm>59)){return 0;}
			i_val+=mm.length;}
		else if (token=="ss"||token=="s") {
			ss=_getInt(val,i_val,token.length,2);
			if(ss==null||(ss<0)||(ss>59)){return 0;}
			i_val+=ss.length;}
		else if (token=="a") {
			if (val.substring(i_val,i_val+2).toLowerCase()=="am") {ampm="AM";}
			else if (val.substring(i_val,i_val+2).toLowerCase()=="pm") {ampm="PM";}
			else {return 0;}
			i_val+=2;}
		else {
			if (val.substring(i_val,i_val+token.length)!=token) {return 0;}
			else {i_val+=token.length;}
			}
		}
	// If there are any trailing characters left in the value, it doesn't match
	if (i_val != val.length) { return 0; }
	// Is date valid for month?
	if (month==2) {
		// Check for leap year
		if ( ( (year%4==0)&&(year%100 != 0) ) || (year%400==0) ) { // leap year
			if (date > 29){ return 0; }
			}
		else { if (date > 28) { return 0; } }
		}
	if ((month==4)||(month==6)||(month==9)||(month==11)) {
		if (date > 30) { return 0; }
		}
	// Correct hours value
	if (hh<12 && ampm=="PM") { hh=hh-0+12; }
	else if (hh>11 && ampm=="AM") { hh-=12; }
	var newdate=new Date(year,month-1,date,hh,mm,ss);
	return newdate.getTime();}
	

function compareDates(date1,dateformat1,date2,dateformat2) {
	var d1=getDateFromFormat(date1,dateformat1);
	var d2=getDateFromFormat(date2,dateformat2);
	if (d1==0 || d2==0) {
		return -1;
		}
	else if (d1 > d2) {
		return 1;
		}
	return 0;

}
	
function setDates()
{
  	var date_for_check = new Array(4);
	date_for_check[0] = document.getElementById("date_1");
  	date_for_check[1] = document.getElementById("date_2");
  	date_for_check[2] = document.getElementById("date_3");
  	date_for_check[3] = document.getElementById("date_4");
  	dates = document.getElementById("dates");
	   
  	for (i=0; i<4; i++)
  	{
	  	if (date_for_check[i].value!="") {
	  	format = "dd.MM.YYYY";
		date_for_check[i] = getDateFromFormat(date_for_check[i],format)	;
		}
	}
	dates.value = date_for_check[3];
	
}

function setDateDue()
{
  var date_1 = document.getElementById('date_1');	
  var date_2 = document.getElementById('date_2');	
  var date_3 = document.getElementById('date_3');	
  var date_4 = document.getElementById('date_4');	
  var date_due = document.getElementById('date_due');
  var format = "MMM d, y";

  dates_arr = new Array ();
  	if (date_1.value != 0)
  	{
   		var max_date = date_1.value;
	} 
	else 
	{
	 	var max_date = "January 1, 1970"; 
	}
	
	if (date_2.value != 0)
	{
		flag = compareDates(max_date,format,date_2.value,format)
			if (flag == 0) max_date = date_2.value;
	}
	
	if (date_3.value != 0)
	{
		flag = compareDates(max_date,format,date_3.value,format)
			if (flag == 0) max_date = date_3.value;
	}
	
	if (date_4.value != 0)
	{
		flag = compareDates(max_date,format,date_4.value,format)
			if (flag == 0) max_date = date_4.value;
	}
//	alert (max_date);
//	alert(compareDates(date_1.value,format,date_2.value,format));
	date_due.value = max_date;
  
}

function MyClear(ItemId)
{
  var Item = document.getElementById(ItemId);	
  Item.value = "";
  
}
-->
</script>


{admin_header}
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td class="header"> 
	<table cellspacing="1" cellpadding="3" border="0" width="100%" align="center">
	<tr>
		<td class="usual">
			&nbsp;<a href="{admin_href}">{ADMINISTRATION_MSG}</a>&nbsp;&gt;&nbsp;<a href="admin_quotes.php">{ADMIN_QUOTES_MSG}</a>
		</td>
	</tr>
	</table>
</td></tr></table>

<br>

<table width="100%" border="0"  cellpadding="6" cellspacing="1" align="center">
	<tr>
		<td>
			<fieldset>
			<legend>{ADMIN_QUOTE_MSG}</legend>
			
			<!-- begin errors -->
			<tr class="usual">
				<td colspan="2" align="center">
					<div class="error">{errors_list}</div>
				</td>
			</tr>
			<!-- end errors -->
			<!-- begin quote -->
			<table width="100%" border="0" cellspacing="4" cellpadding="4">
				<form name="form_admin_quote_new" id="admin_quote_new" method="post" action="admin_quote_new.php">
				<input type="hidden" name="dates" id="dates" value="{dates}">
				<tr align="left">
					<td>
					<table width=250 cellspacing="2" cellpadding="2" class="quote_details">
						<tr bgcolor="#BFBDBD">
							<td colspan=2>
								<b>{CUSTOMER_DETAILS_MSG}</b>
							</td>
						</tr>
						<tr>
							<td bgcolor = "#E2DDDD">
							{CUSTOMER_NAME_MSG}
							</td>
							<td>
							<input type="text" name="user_name" id="user_name" value="{user_name}">
							</td>
						</tr>
						<tr>
							<td bgcolor = "#E2DDDD">
							{CUSTOMER_EMAIL_MSG}
							</td>
							<td>
							<input type="text" name="user_email" id="user_email" value="{user_email}">
							</td>
						</tr>
					</table>
					</td>
					<td align=right>
						<table>
							<tr>
								<td align=left>
									{TOTAL_PRICE_MSG}: 
								</td>
								<td align=right>
									<input type="text" name="quoted_price" id="quoted_price" value="{quoted_price}">
								</td>
							</tr>
							<tr>
								<td align=left>
									{DATE_DUE_MSG}: 
								</td>
								<td align=right>
									<input type="text" name="date_due" id="date_due" value="{date_due}">
								</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr class="usual"> 
						<td align="center" colspan=2>
							<table border=0 cellspacing="4" cellpadding="4">
								<tr>
									<td rowspan="4" valign=top>
										<input type="hidden" name="changed_descr" id="changed_descr" value="{changed_descr}">
										<textarea name="request_description" id="request_description" cols=50 rows=15 onChange="Change{DESC_MSG}r();">{request_description}</textarea>
									<!--	<input type="text" name="request_description" id="request_description" value="{request_description}">-->
										<br>
										<input type="button" value="{CLEAR_BUTTON}" onClick="MyClear('request_description')">
									</td>
									<td bgcolor="#E2DDDD">
										<input type="button" name="copy1" id="copy1" Value="Copy -> " onmousedown="getSelText_my('feature_1')">	<br>
										<input type="button" value="{CLEAR_BUTTON}" onClick="MyClear('feature_1')">
									</td>
									<td>
										Feature #1: <br><textarea name="feature_1" id="feature_1"></textarea>	
									</td>
									<td>
										<table>
											<tr>
												<td>
													{PRICE_MSG}: 
												</td>
												<td>
													<input type="text" name="price_1" id="price_1" onChange="setPrice();">
												</td>
											</tr>
											<tr>
												<td>
													{DATE_DUE_MSG}: 
												</td>
												<td>
													<font size=1>(example: January 1, 2006)</font><br>
													<input type="text" name="date_1" id="date_1" onChange='setDateDue(); CheckDate("date_1");'>
												</td>
											</tr>
										</table>
									</td>
								</tr>
								<tr>
									<td bgcolor="#E2DDDD" cellspacing=2>
										<input type="button" name="copy2" id="copy2" Value="Copy ->" onmousedown="getSelText_my('feature_2')">
										<br>
										<input type="button" value="{CLEAR_BUTTON}" onClick="MyClear('feature_2')">
									</td>
									<td>
										Feature #2: <br><textarea name="feature_2" id="feature_2"></textarea>	
									</td>
									<td>
										<table>
											<tr>
												<td>
													{PRICE_MSG}: 
												</td>
												<td>
													<input type="text" name="price_2" id="price_2" onChange="setPrice();">
												</td>
											</tr>
											<tr>
												<td>	
													{DATE_DUE_MSG}: 
												</td>
												<td>
													<input type="text" name="date_2" id="date_2" onChange='setDateDue(); CheckDate("date_2");'>
												</td>
											</tr>
										</table>
									</td>
								</tr>
								<tr>
									<td bgcolor="#E2DDDD">	
										<input type="button" name="copy3" id="copy3" Value="Copy -> " onmousedown="getSelText_my('feature_3')">	
										<br>
										<input type="button" value="{CLEAR_BUTTON}" onClick="MyClear('feature_3')">
									</td>
									<td>
										Feature #3: <br><textarea name="feature_3" id="feature_3"></textarea>	
									</td>
									<td>
										<table>
											<tr>
												<td>
													{PRICE_MSG}: 
												</td>
												<td>
													<input type="text" name="price_3" id="price_3" onChange="setPrice();">
												</td>
											</tr>
											<tr>
												<td>	
													{DATE_DUE_MSG}: 
												</td>
												<td>
													<input type="text" name="date_3" id="date_3" onChange='setDateDue(); CheckDate("date_3");'>
												</td>
											</tr>
										</table>
									</td>
								</tr>
								<tr>
									<td bgcolor="#E2DDDD">	
										<input type="button" name="copy4" id="copy4" Value="Copy -> " onmousedown="getSelText_my('feature_4')">	
										<br>
										<input type="button" value="{CLEAR_BUTTON}" onClick="MyClear('feature_4')">
									</td>
									<td>
										Feature #4: <br><textarea name="feature_4" id="feature_4"></textarea>	
									</td>
									<td>
										<table>
											<tr>
												<td>
													{PRICE_MSG}: 
												</td>
												<td>
													<input type="text" name="price_4" id="price_4" onChange='setPrice();'>
												</td>
											</tr>
											<tr>
												<td>	
													{DATE_DUE_MSG}: 
												</td>
												<td>
													<input type="text" name="date_4" id="date_4" onChange='setDateDue(); CheckDate("date_4");'>
												</td>
											</tr>
										</table>
									</td>
								</tr>
								<tr>
									<td align=right colspan=3>
										<input type="button" value="{ADMIN_QUOTE_MSG}" onClick="CheckForm(); return CheckDate_2(); ">
									</td>
								</tr>
							</table>
						
						</td>
				</tr>
				</form>
				</table>
			<!-- end quote -->
			
			</fieldset>
		</td>
	</tr>
</table>	
{admin_footer}

</body>
</html>
